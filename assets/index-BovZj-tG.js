(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const g of c.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function a(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(n){if(n.ep)return;n.ep=!0;const c=a(n);fetch(n.href,c)}})();async function S(e){const t=new Image;return await new Promise(a=>{t.src=URL.createObjectURL(e),t.onload=a}),{height:t.height,width:t.width}}async function q(e,t,a){const i=new OffscreenCanvas(t,a).getContext("2d");return i.drawImage(await createImageBitmap(e),0,0),i.getImageData(0,0,t,a)}function A(e,t,a,i,n){const c=e.width,g=e.height,b=i*.5,v=Math.sqrt(t*t+1),x=t*a.x+a.y,C=n?-1:1;for(let r=0;r<c;r++)for(let l=0;l<g;l++){const p=(-t*r-l+x)/v;e.data[(r+l*c)*4+3]=128-p/b*128*C}return e}function F(e,t,a,i,n){const c=e.width,g=e.height,b=i*.5,v=a.x,x=a.y,C=n?-1:1;for(let r=0;r<c;r++)for(let l=0;l<g;l++){const p=r-v,O=l-x,M=Math.sqrt(p*p+O*O);e.data[(r+l*c)*4+3]=128-(M-t)/b*128*C}return e}let L="Linear",d=100,u=0,s=50,k=!1,w=50,I=50,f=null,R=null,y=null,E=null,m=null,h=null,B=0;async function o(){const e=m,t=h;if(f.width=e,f.height=t,R.drawImage(y,0,0),!E)return;const a=new ImageData(E.data.slice(0),e);switch(L){case"Linear":{A(a,Math.tan(u*Math.PI/180),{x:w,y:I},d,k);break}case"Circular":{F(a,s,{x:w,y:I},d,k);break}}R.drawImage(await createImageBitmap(a),0,0)}function N(){document.getElementById("base-img").onchange=async e=>{X();const a=e.target.files[0],{width:i,height:n}=await S(a);m=i,h=n,y=await createImageBitmap(a),o()},document.getElementById("overlay-img").onchange=async e=>{const a=e.target.files[0],{width:i,height:n}=await S(a);if(m!==i||h!==n){alert("「ベース画像」と「重ねる画像」の大きさが違います。");return}E=await q(a,i,n),o()},document.getElementById("linear").onchange=e=>{L=e.target.checked?"Linear":"Circular",o()},document.getElementById("circular").onchange=e=>{L=e.target.checked?"Circular":"Linear",o()},document.getElementById("change-width").onchange=e=>{const t=Number.parseInt(e.target.value);t<0?(d=0,e.target.value="0"):d=t,o()},document.getElementById("change-width-minus").onclick=()=>{d=Math.max(d-50,0),document.getElementById("change-width").value=d.toString(),o()},document.getElementById("change-width-plus").onclick=()=>{d+=50,document.getElementById("change-width").value=d.toString(),o()},document.getElementById("gradient").onchange=e=>{u=Number.parseInt(e.target.value),o()},document.getElementById("gradient-minus").onclick=()=>{u-=10,document.getElementById("gradient").value=u.toString(),o()},document.getElementById("gradient-plus").onclick=()=>{u+=10,document.getElementById("gradient").value=u.toString(),o()},document.getElementById("radius").onchange=e=>{const t=Number.parseInt(e.target.value);t<0?(s=0,e.target.value="0"):s=t,o()},document.getElementById("radius-minus").onclick=()=>{s=Math.max(s-50,0),document.getElementById("radius").value=s.toString(),o()},document.getElementById("radius-plus").onclick=()=>{s+=50,document.getElementById("radius").value=s.toString(),o()},document.getElementById("invert").onclick=e=>{k=e.target.checked,o()},document.getElementById("save-btn").onclick=async()=>{const e=document.createElement("a");e.download="download.webp",e.href=f.toDataURL("image/webp",.92),document.body.appendChild(e),e.click(),document.body.removeChild(e)},document.getElementById("fullscr-btn").onclick=()=>{f.requestFullscreen()},document.getElementById("canvas").onmousedown=e=>{const t=e.target.getBoundingClientRect();w=(e.pageX-(t.left+window.scrollX))*(m/t.width),I=(e.pageY-(t.top+window.scrollY))*(h/t.height),o()},document.getElementById("canvas").onmousemove=e=>{if(e.buttons!==1)return;cancelAnimationFrame(B);const t=e.target.getBoundingClientRect();w=(e.pageX-(t.left+window.scrollX))*(m/t.width),I=(e.pageY-(t.top+window.scrollY))*(h/t.height),B=requestAnimationFrame(o)},document.getElementById("canvas").ontouchmove=e=>{e.preventDefault(),cancelAnimationFrame(B);const t=e.target.getBoundingClientRect();w=(e.touches[0].pageX-(t.left+window.scrollX))*(m/t.width),I=(e.touches[0].pageY-(t.top+window.scrollY))*(h/t.height),B=requestAnimationFrame(o)}}function X(){y==null||y.close(),y=null,E=null}async function Y(){f=document.getElementById("canvas"),R=f.getContext("2d"),N()}Y();
