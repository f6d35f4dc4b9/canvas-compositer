(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const g of c.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function a(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(n){if(n.ep)return;n.ep=!0;const c=a(n);fetch(n.href,c)}})();async function k(e){const t=new Image;return await new Promise(a=>{t.src=URL.createObjectURL(e),t.onload=a}),{height:t.height,width:t.width}}async function A(e,t,a){const i=new OffscreenCanvas(t,a).getContext("2d");return i.drawImage(await createImageBitmap(e),0,0),i.getImageData(0,0,t,a)}function N(e,t,a,i,n){const c=e.width,g=e.height,v=i*.5,x=Math.sqrt(t*t+1),b=t*a.x+a.y,C=n?-1:1;for(let r=0;r<c;r++)for(let l=0;l<g;l++){const I=(-t*r-l+b)/x;e.data[(r+l*c)*4+3]=128+I/v*128*C}return e}function X(e,t,a,i,n){const c=e.width,g=e.height,v=i*.5,x=a.x,b=a.y,C=n?-1:1;for(let r=0;r<c;r++)for(let l=0;l<g;l++){const I=r-x,S=l-b,M=Math.sqrt(I*I+S*S);e.data[(r+l*c)*4+3]=128+(M-t)/v*128*C}return e}let L="Linear",d=200,u=0,s=100,O=!1,y=50,w=50,B=null,R=null,f=null,E=null,m=null,h=null,p=0;async function o(){const e=m,t=h;if(B.width=e,B.height=t,R.drawImage(f,0,0),!E)return;const a=new ImageData(E.data.slice(0),e);switch(L){case"Linear":{N(a,Math.tan(u*Math.PI/180),{x:y,y:w},d,O);break}case"Circular":{X(a,s,{x:y,y:w},d,O);break}}R.drawImage(await createImageBitmap(a),0,0)}function Y(){document.getElementById("base-img").onchange=async e=>{q();const a=e.target.files[0],{width:i,height:n}=await k(a);m=i,h=n,f=await createImageBitmap(a),o()},document.getElementById("overlay-img").onchange=async e=>{const a=e.target.files[0],{width:i,height:n}=await k(a);if(m!==i||h!==n){alert("「ベース画像」と「重ねる画像」の大きさが違います。");return}E=await A(a,i,n),o()},document.getElementById("linear").onchange=e=>{L=e.target.checked?"Linear":"Circular",o()},document.getElementById("circular").onchange=e=>{L=e.target.checked?"Circular":"Linear",o()},document.getElementById("change-width").onchange=e=>{const t=Number.parseInt(e.target.value);t<0?(d=0,e.target.value="0"):d=t,o()},document.getElementById("change-width-minus").onclick=()=>{d=Math.max(d-50,0),document.getElementById("change-width").value=d.toString(),o()},document.getElementById("change-width-plus").onclick=()=>{d+=50,document.getElementById("change-width").value=d.toString(),o()},document.getElementById("gradient").onchange=e=>{u=Number.parseInt(e.target.value),o()},document.getElementById("gradient-minus").onclick=()=>{u-=10,document.getElementById("gradient").value=u.toString(),o()},document.getElementById("gradient-plus").onclick=()=>{u+=10,document.getElementById("gradient").value=u.toString(),o()},document.getElementById("radius").onchange=e=>{const t=Number.parseInt(e.target.value);t<0?(s=0,e.target.value="0"):s=t,o()},document.getElementById("radius-minus").onclick=()=>{s=Math.max(s-50,0),document.getElementById("radius").value=s.toString(),o()},document.getElementById("radius-plus").onclick=()=>{s+=50,document.getElementById("radius").value=s.toString(),o()},document.getElementById("invert").onclick=e=>{O=e.target.checked,o()},document.getElementById("canvas").onmousedown=e=>{const t=e.target.getBoundingClientRect();y=(e.pageX-(t.left+window.scrollX))*(m/t.width),w=(e.pageY-(t.top+window.scrollY))*(h/t.height),o()},document.getElementById("canvas").onmousemove=e=>{if(e.buttons!==1)return;cancelAnimationFrame(p);const t=e.target.getBoundingClientRect();y=(e.pageX-(t.left+window.scrollX))*(m/t.width),w=(e.pageY-(t.top+window.scrollY))*(h/t.height),p=requestAnimationFrame(o)},document.getElementById("canvas").ontouchmove=e=>{cancelAnimationFrame(p);const t=e.target.getBoundingClientRect();y=(e.touches[0].pageX-(t.left+window.scrollX))*(m/t.width),w=(e.touches[0].pageY-(t.top+window.scrollY))*(h/t.height),p=requestAnimationFrame(o)}}function q(){f==null||f.close(),f=null,E=null}async function F(){B=document.getElementById("canvas"),R=B.getContext("2d"),Y()}F();
